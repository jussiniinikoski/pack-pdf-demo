<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>PACK-PDF</title>
</head>

<body>
    <p>
        <a href="javascript:void(0)" id="generate-link">Generate PDF</a>
        <span id="generate-msg" style="display: none">Generating PDF...</span>
        <a href="#" id="download-link" download="sample.pdf" style="display: none">Download PDF</a>
    </p>
    <script>
        let generateLink = document.getElementById("generate-link");
        let generateMsg = document.getElementById("generate-msg");
        let downloadLink = document.getElementById("download-link");
        generateLink.addEventListener('click', (e) => {
            e.preventDefault();
            generateLink.style.display = 'none';
            generateMsg.style.display = 'block';
            fetch("./simple-example.json")
                .then(response => {
                    return response.json();
                })
                .then(doc => {
                    createPDF(doc);
                });
        });

        let pdfFileBlobURL = null;
        let generatePDF = (data) => {
            const blob = new Blob([data], {
                type: 'application/pdf'
            });
            if (pdfFileBlobURL !== null) {
                URL.revokeObjectURL(pdfFileBlobURL);
            }
            pdfFileBlobURL = URL.createObjectURL(blob);
            // for debugging purposes, open another window
            //window.open(pdfFileBlobURL, "_blank");
            downloadLink.href = pdfFileBlobURL;
            generateMsg.style.display = 'none';
            downloadLink.style.display = 'block';
        }

        let jsonOut = (data) => {
            console.log(JSON.stringify(data));
        };
    </script>
<script type="text/javascript" src="index.js"></script></body>
</html>